block' : 'none' }} onClick={() => toggleTriangle('tri-top')} />
                        </svg>
                    </div>

                    {/* 右侧面板：工程图编辑器 (仅在蓝图模式显示) */}
                    <div className="w-80 bg-white border-l p-4 flex flex-col gap-4 overflow-y-auto z-10 shadow-lg">
                        <div className="pb-2 border-b"><h3 className="font-bold text-gray-700">工程图编辑器</h3><p className="text-xs text-gray-500">在此处修改数值会覆盖自动计算结果。</p></div>
                        <div>
                            <h4 className="text-xs font-bold text-gray-400 uppercase mb-2">标注文字</h4>
                            <div className="space-y-2">
                                {textElements.map(el => {
                                    if (el.id === 'txt-h54' && !showTotalHeight) return null;
                                    return (
                                        <div key={el.id} className="flex flex-col bg-gray-50 p-2 rounded border border-transparent focus-within:border-blue-300 focus-within:bg-blue-50 transition-colors">
                                            <label className="text-[10px] text-gray-500 font-semibold">{el.label}</label>
                                            <input type="text" value={textOverrides[el.id] || ''} onChange={(e) => handleTextChange(el.id, e.target.value)} className="bg-transparent outline-none text-sm text-gray-800" />
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                        <div>
                            <h4 className="text-xs font-bold text-gray-400 uppercase mb-2">红色标记 (三角形)</h4>
                            <div className="space-y-2">
                                {TRIANGLE_MAPPING.map(item => (
                                    <div key={item.id} className="flex items-center justify-between p-2 rounded bg-gray-50 border hover:bg-gray-100 cursor-pointer" onClick={() => toggleTriangle(item.id)}>
                                        <span className="text-sm text-gray-700">{item.label}</span>
                                        <div className={`w-9 h-5 rounded-full relative transition-colors ${visibleTriangles[item.id] ? 'bg-red-500' : 'bg-gray-300'}`}>
                                            <div className={`absolute top-1 left-1 bg-white w-3 h-3 rounded-full transition-transform ${visibleTriangles[item.id] ? 'translate-x-4' : 'translate-x-0'}`} />
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const InputGroup = ({ label, id, value, onChange, color = 'blue', active }) => (
            <div className="relative group">
                <input type="number" id={id} value={value} onChange={(e) => onChange(e.target.value)} className={`w-full p-2 pt-5 text-sm border rounded outline-none transition-colors ${color === 'orange' ? 'bg-orange-50/30 focus:ring-orange-100' : 'focus:ring-blue-100'} ${active ? (color === 'orange' ? 'border-orange-300' : 'border-blue-300') : 'border-gray-300'}`} />
                <span className="absolute left-2 top-1 text-[10px] text-gray-400 font-bold pointer-events-none group-focus-within:text-gray-600">{label}</span>
            </div>
        );

        const PolishBtn = ({ label, active, onClick }) => (
            <button onClick={onClick} className={`flex items-center justify-center p-2 border rounded text-xs font-medium transition-all ${active ? 'bg-slate-800 text-white border-slate-800 shadow-sm' : 'bg-white hover:bg-gray-50 text-gray-700 border-gray-200'}`}>{label}</button>
        );

        const ResultRow = ({ label, value, bold }) => (
            <div className="flex justify-between"><span className="text-blue-400">{label}:</span><span className={`font-mono ${bold ? 'font-bold text-slate-800' : 'text-slate-600'}`}>{value.toFixed(1)}</span></div>
        );

        const App = () => {
            const [viewMode, setViewMode] = useState('CALCULATOR');
            const [inputs, setInputs] = useState({ radiusOut: '5020', arcOut: '983', chordOut: '', totalHeight: '', radiusIn: '', arcIn: '' });
            const [dims, setDims] = useState({ width: 2000, thickness: 30 });
            const [polish, setPolish] = useState({ face: true, neiHu: false, shangL: false, xiaL: false, leftW: false, rightW: false });
            const [showTotalHeight, setShowTotalHeight] = useState(false);
            const [result, setResult] = useState(null);

            const handleInputChange = (field, value) => setInputs(prev => ({ ...prev, [field]: value }));
            const handleDimChange = (field, value) => setDims(prev => ({ ...prev, [field]: parseFloat(value) || 0 }));
            const togglePolish = (field) => setPolish(prev => ({ ...prev, [field]: !prev[field] }));
            const resetParams = () => setInputs({ radiusOut: '', arcOut: '', chordOut: '', totalHeight: '', radiusIn: '', arcIn: '' });

            useEffect(() => { setResult(calculateGeometry(inputs, dims)); }, [inputs, dims]);

            return (
                <div className="flex flex-row h-screen w-screen overflow-hidden bg-gray-50">
                    {/* 左侧侧边栏 (固定宽度，始终显示) */}
                    <div className="w-[360px] bg-white border-r flex flex-col h-full shadow-xl z-20 flex-shrink-0">
                         <div className="p-4 border-b flex items-center justify-between bg-white">
                            <div className="flex items-center gap-2">
                                <div className="bg-blue-600 text-white p-1.5 rounded-md"><Ruler size={18} /></div>
                                <h1 className="font-bold text-lg text-gray-800">弧形板计算大师</h1>
                            </div>
                         </div>
                         
                         <div className="flex-1 overflow-y-auto p-5 space-y-6">
                            {/* 视图切换 */}
                            <div className="flex bg-gray-100 p-1 rounded-lg mb-4">
                                <button onClick={() => setViewMode('CALCULATOR')} className={`flex-1 flex items-center justify-center gap-2 py-1.5 rounded text-sm font-medium transition-all ${viewMode === 'CALCULATOR' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}><Ruler size={14} /> 计算预览</button>
                                <button onClick={() => setViewMode('BLUEPRINT')} className={`flex-1 flex items-center justify-center gap-2 py-1.5 rounded text-sm font-medium transition-all ${viewMode === 'BLUEPRINT' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}><FileText size={14} /> 工程蓝图</button>
                            </div>

                            {/* 参数设置区 (始终显示) */}
                            <div>
                                <div className="flex items-center justify-between pb-2 border-b mb-4"><h2 className="font-bold text-gray-700">参数设置</h2><button onClick={resetParams} className="text-xs text-blue-600 flex items-center gap-1 hover:bg-blue-50 px-2 py-1 rounded transition-colors"><RotateCcw size={12} /> 重置</button></div>
                                <div className="space-y-4">
                                    <div>
                                        <label className="text-xs font-bold text-gray-400 uppercase mb-2 block">几何参数 (任选2项)</label>
                                        <div className="grid grid-cols-2 gap-3">
                                            <InputGroup label="外半径 (R)" id="radiusOut" value={inputs.radiusOut} onChange={(v) => handleInputChange('radiusOut', v)} active={!!result?.valid && !!inputs.radiusOut} />
                                            <InputGroup label="外弧长 (L)" id="arcOut" value={inputs.arcOut} onChange={(v) => handleInputChange('arcOut', v)} active={!!result?.valid && !!inputs.arcOut} />
                                            <InputGroup label="外弦长 (C)" id="chordOut" value={inputs.chordOut} onChange={(v) => handleInputChange('chordOut', v)} active={!!result?.valid && !!inputs.chordOut} />
                                            <InputGroup label="总拱高 (H)" id="totalHeight" value={inputs.totalHeight} onChange={(v) => handleInputChange('totalHeight', v)} active={!!result?.valid && !!inputs.totalHeight} />
                                            <InputGroup label="内半径 (r)" id="radiusIn" value={inputs.radiusIn} onChange={(v) => handleInputChange('radiusIn', v)} color="orange" active={!!result?.valid && !!inputs.radiusIn} />
                                            <InputGroup label="内弧长 (l)" id="arcIn" value={inputs.arcIn} onChange={(v) => handleInputChange('arcIn', v)} color="orange" active={!!result?.valid && !!inputs.arcIn} />
                                        </div>
                                        <div className={`mt-3 text-xs flex items-center gap-1 font-medium ${result?.valid ? 'text-green-600' : (result?.errorMsg ? 'text-red-500' : 'text-orange-500')}`}>
                                            {result?.valid ? <><CheckCircle2 size={12} /> 计算方式: {result.method}</> : <><AlertCircle size={12} /> {result?.errorMsg || "请输入至少2个参数"}</>}
                                        </div>
                                    </div>
                                     <div>
                                        <label className="text-xs font-bold text-gray-400 uppercase mb-2 block">板材尺寸</label>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div className="relative"><input type="number" value={dims.width} onChange={(e) => handleDimChange('width', e.target.value)} className="w-full p-2 text-sm border border-gray-300 rounded outline-none focus:border-blue-500" /><span className="absolute right-2 top-2 text-xs text-gray-400 pointer-events-none">W (宽)</span></div>
                                            <div className="relative"><input type="number" value={dims.thickness} onChange={(e) => handleDimChange('thickness', e.target.value)} className="w-full p-2 text-sm border border-gray-300 rounded outline-none focus:border-blue-500" /><span className="absolute right-2 top-2 text-xs text-gray-400 pointer-events-none">T (厚)</span></div>
                                        </div>
                                    </div>
                                     <div className="bg-gray-50 p-2 rounded border border-gray-100">
                                         <button onClick={() => setShowTotalHeight(!showTotalHeight)} className={`w-full flex items-center justify-between px-3 py-2 rounded text-xs font-medium border transition-colors ${showTotalHeight ? 'bg-blue-100 border-blue-200 text-blue-700' : 'bg-white border-gray-200 text-gray-600 hover:bg-gray-50'}`}>
                                            <span className="flex items-center gap-2">{showTotalHeight ? <Eye size={14} /> : <EyeOff size={14} />} 显示总高 (H)</span>
                                            <span className={`w-8 h-4 rounded-full relative transition-colors ${showTotalHeight ? 'bg-blue-500' : 'bg-gray-300'}`}><span className={`absolute top-0.5 left-0.5 w-3 h-3 bg-white rounded-full transition-transform ${showTotalHeight ? 'translate-x-4' : 'translate-x-0'}`} /></span>
                                        </button>
                                     </div>
                                    <div className="pt-2 border-t">
                                         <label className="text-xs font-bold text-gray-400 uppercase mb-3 block">抛光/标识 (红色)</label>
                                         <div className="grid grid-cols-3 gap-2">
                                            <PolishBtn label="外弧面" active={polish.face} onClick={() => togglePolish('face')} />
                                            <PolishBtn label="内弧面" active={polish.neiHu} onClick={() => togglePolish('neiHu')} />
                                            <PolishBtn label="上口 (L)" active={polish.shangL} onClick={() => togglePolish('shangL')} />
                                            <PolishBtn label="下口 (L)" active={polish.xiaL} onClick={() => togglePolish('xiaL')} />
                                            <PolishBtn label="左侧 (W)" active={polish.leftW} onClick={() => togglePolish('leftW')} />
                                            <PolishBtn label="右侧 (W)" active={polish.rightW} onClick={() => togglePolish('rightW')} />
                                         </div>
                                    </div>
                                     {result?.valid && (
                                         <div className="bg-blue-50 rounded-lg p-3 border border-blue-100 text-xs mt-auto">
                                            <h3 className="font-bold text-blue-800 mb-2">计算结果</h3>
                                            <div className="grid grid-cols-2 gap-y-1 gap-x-2">
                                                <ResultRow label="外半径 R" value={result.R_out} />
                                                <ResultRow label="内半径 r" value={result.R_in} bold />
                                                <ResultRow label="外弧长 L" value={result.L_arc_out} />
                                                <ResultRow label="内弧长 l" value={result.L_arc_in} bold />
                                                <ResultRow label="弦长 C" value={result.chord_out} />
                                                <ResultRow label="总高 H" value={result.total_h} bold />
                                            </div>
                                         </div>
                                     )}
                                </div>
                            </div>
                         </div>
                    </div>

                    {/* 右侧主绘图区 (自适应剩余空间) */}
                    <div className="flex-1 bg-gray-50 relative overflow-hidden flex flex-col h-full bg-grid-pattern">
                        {viewMode === 'CALCULATOR' ? (
                            <div className="w-full h-full flex items-center justify-center p-8">
                                <div className="w-full h-full bg-white rounded-lg border shadow-sm overflow-hidden relative">
                                    {result && <Calculator3DPreview result={result} dims={dims} polish={polish} showTotalHeight={showTotalHeight} />}
                                </div>
                            </div>
                        ) : (
                            <div className="w-full h-full overflow-hidden">
                                {result && <BlueprintView result={result} dims={dims} polish={polish} showTotalHeight={showTotalHeight} />}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
