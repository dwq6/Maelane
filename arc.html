<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>弧形板计算器</title>
    
    <!-- 1. 样式库 -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React 核心库 -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Babel 编译器 -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .bg-grid-pattern {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 h-screen w-screen overflow-hidden">
    <div id="root" class="h-full w-full"></div>

    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            document.getElementById('root').innerHTML = '<div style="color:red;padding:20px;">程序运行出错: ' + message + '</div>';
        };
    </script>

    <script type="text/babel" data-presets="react">
        const { useState, useEffect, useMemo } = React;
        const { createRoot } = ReactDOM;

        // --- 图标组件 ---
        const IconBase = ({ children, size = 18, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const RotateCcw = (p) => <IconBase {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>;
        const Ruler = (p) => <IconBase {...p}><path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0l12.6 12.6z"/><path d="m14.5 12.5 2-2"/><path d="m11.5 9.5 2-2"/><path d="m8.5 6.5 2-2"/><path d="m17.5 15.5 2-2"/></IconBase>;
        const FileText = (p) => <IconBase {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></IconBase>;
        const CheckCircle2 = (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>;
        const AlertCircle = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>;
        const Eye = (p) => <IconBase {...p}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></IconBase>;
        const EyeOff = (p) => <IconBase {...p}><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7c.44 0 .87-.03 1.28-.08"/><line x1="2" x2="22" y1="2" y2="22"/></IconBase>;

        // --- 计算逻辑 ---
        const calculateGeometry = (inputs, dims) => {
            const W = dims.width || 1000;
            const T = dims.thickness || 20;
            const R_out_in = parseFloat(inputs.radiusOut);
            const A_out_in = parseFloat(inputs.arcOut);
            const C_out_in = parseFloat(inputs.chordOut);
            const H_total_in = parseFloat(inputs.totalHeight);
            const R_in_in = parseFloat(inputs.radiusIn);
            const A_in_in = parseFloat(inputs.arcIn);

            let H_geom_in = NaN;
            if (!isNaN(H_total_in)) H_geom_in = H_total_in - T;

            let R = 0, Theta = 0, valid = false, method = '', errorMsg = '';

            if (R_out_in && R_in_in && !A_out_in && !C_out_in && isNaN(H_total_in) && !A_in_in) {
                errorMsg = "仅有半径无法确定弧长，请补充：弧长、弦长或总高";
            } else {
                try {
                    if (R_out_in) {
                        R = R_out_in;
                        if (A_out_in) { Theta = A_out_in / R; method = 'R外+L外'; valid = true; }
                        else if (C_out_in) {
                            if (C_out_in > 2 * R) throw new Error("弦长不能大于直径");
                            Theta = 2 * Math.asin(C_out_in / (2 * R)); method = 'R外+C外'; valid = true;
                        }
                        else if (!isNaN(H_geom_in)) {
                            if (H_geom_in >= R) throw new Error("拱高不能大于半径");
                            if (H_geom_in <= 0) throw new Error("总高必须大于板厚");
                            Theta = 2 * Math.acos(1 - H_geom_in / R); method = 'R外+H总'; valid = true;
                        }
                        else if (A_in_in) {
                            if (R <= T) throw new Error("外半径必须大于板厚");
                            Theta = A_in_in / (R - T); method = 'R外+L内'; valid = true;
                        }
                    } else if (R_in_in) {
                        R = R_in_in + T;
                        if (A_in_in) { Theta = A_in_in / R_in_in; method = 'R内+L内'; valid = true; }
                        else if (A_out_in) { Theta = A_out_in / R; method = 'R内+L外'; valid = true; }
                    } else if (C_out_in && !isNaN(H_geom_in)) {
                        if (H_geom_in <= 0) throw new Error("总高必须大于板厚");
                        R = (Math.pow(C_out_in, 2) / (8 * H_geom_in)) + (H_geom_in / 2);
                        Theta = 2 * Math.asin(C_out_in / (2 * R));
                        method = 'C外+H总'; valid = true;
                    } else if (A_out_in && A_in_in) {
                        if (A_out_in <= A_in_in) throw new Error("外弧长必须大于内弧长");
                        R = (A_out_in * T) / (A_out_in - A_in_in);
                        Theta = A_out_in / R;
                        method = 'L外+L内'; valid = true;
                    }
                } catch (e) { errorMsg = e.message; }
            }

            if (!valid) return { valid: false, errorMsg, R_out: 0, R_in: 0, L_arc_out: 0, L_arc_in: 0, chord_out: 0, chord_in: 0, sagitta_out: 0, total_h: 0, theta: 0 };

            const R_in = R - T;
            const sagitta_geom = R * (1 - Math.cos(Theta / 2));
            const total_h = sagitta_geom + T * Math.cos(Theta / 2);

            return {
                valid: true, method, R_out: R, R_in: R_in,
                L_arc_out: Theta * R, L_arc_in: Theta * R_in,
                chord_out: 2 * R * Math.sin(Theta / 2),
                chord_in: 2 * R_in * Math.sin(Theta / 2),
                sagitta_out: sagitta_geom, total_h: total_h, theta: Theta
            };
        };

        const polarToCartesian = (cx, cy, r, angle) => ({ x: cx + r * Math.sin(angle), y: cy - r * Math.cos(angle) });

        // --- 预览组件 ---
        const Calculator3DPreview = ({ result, dims, polish, showTotalHeight }) => {
            const svgContent = useMemo(() => {
                if (!result.valid) return null;
                const { theta, R_out, R_in, L_arc_out, L_arc_in, chord_out, chord_in, total_h } = result;
                const W = dims.width;
                const T = dims.thickness;
                
                const perspectiveAngle = 30 * (Math.PI / 180);
                const depthScale = 0.5;
                const dx = W * Math.cos(perspectiveAngle) * depthScale;
                const dy = -W * Math.sin(perspectiveAngle) * depthScale;
                const cx = 0, cy = R_out;
                const startAngle = -theta / 2, endAngle = theta / 2;

                const p_out_left = polarToCartesian(cx, cy, R_out, startAngle);
                const p_in_left = polarToCartesian(cx, cy, R_in, startAngle);
                const p_out_right = polarToCartesian(cx, cy, R_out, endAngle);
                const p_in_right = polarToCartesian(cx, cy, R_in, endAngle);
                const project = (p) => ({ x: p.x + dx, y: p.y + dy });
                const p_out_left_back = project(p_out_left);
                const p_in_left_back = project(p_in_left);
                const p_out_right_back = project(p_out_right);
                const p_in_right_back = project(p_in_right);

                const pathFace = `M ${p_out_left.x} ${p_out_left.y} A ${R_out} ${R_out} 0 0 1 ${p_out_right.x} ${p_out_right.y} L ${p_out_right_back.x} ${p_out_right_back.y} A ${R_out} ${R_out} 0 0 0 ${p_out_left_back.x} ${p_out_left_back.y} Z`;
                const pathRightW = `M ${p_out_right.x} ${p_out_right.y} L ${p_out_right_back.x} ${p_out_right_back.y} L ${p_in_right_back.x} ${p_in_right_back.y} L ${p_in_right.x} ${p_in_right.y} Z`;
                const pathXiaL = `M ${p_out_left.x} ${p_out_left.y} A ${R_out} ${R_out} 0 0 1 ${p_out_right.x} ${p_out_right.y} L ${p_in_right.x} ${p_in_right.y} A ${R_in} ${R_in} 0 0 0 ${p_in_left.x} ${p_in_left.y} Z`;

                const getEdgeStyle = (f1, f2) => ({ color: (polish[f1] && polish[f2]) ? "#ef4444" : "black", width: (polish[f1] && polish[f2]) ? 2.5 : 1 });
                const edges = [
                     { d: `M ${p_out_left.x} ${p_out_left.y} A ${R_out} ${R_out} 0 0 1 ${p_out_right.x} ${p_out_right.y}`, ...getEdgeStyle('face', 'xiaL') },
                     { d: `M ${p_in_left.x} ${p_in_left.y} A ${R_in} ${R_in} 0 0 1 ${p_in_right.x} ${p_in_right.y}`, ...getEdgeStyle('xiaL', 'neiHu') },
                     { d: `M ${p_out_left.x} ${p_out_left.y} L ${p_in_left.x} ${p_in_left.y}`, ...getEdgeStyle('xiaL', 'leftW') },
                     { d: `M ${p_out_right.x} ${p_out_right.y} L ${p_in_right.x} ${p_in_right.y}`, ...getEdgeStyle('xiaL', 'rightW') },
                     { d: `M ${p_out_left.x} ${p_out_left.y} L ${p_out_left_back.x} ${p_out_left_back.y}`, ...getEdgeStyle('face', 'leftW') },
                     { d: `M ${p_out_right.x} ${p_out_right.y} L ${p_out_right_back.x} ${p_out_right_back.y}`, ...getEdgeStyle('face', 'rightW') },
                     { d: `M ${p_out_right_back.x} ${p_out_right_back.y} A ${R_out} ${R_out} 0 0 0 ${p_out_left_back.x} ${p_out_left_back.y}`, ...getEdgeStyle('face', 'shangL') },
                     { d: `M ${p_in_right.x} ${p_in_right.y} L ${p_in_right_back.x} ${p_in_right_back.y}`, ...getEdgeStyle('rightW', 'neiHu') },
                     { d: `M ${p_out_right_back.x} ${p_out_right_back.y} L ${p_in_right_back.x} ${p_in_right_back.y}`, ...getEdgeStyle('rightW', 'shangL') },
                ];

                const p_mid_front = polarToCartesian(cx, cy, R_out, 0);
                const p_mid_back = project(p_mid_front);
                const mark_face = { x: (p_mid_front.x + p_mid_back.x) / 2, y: (p_mid_front.y + p_mid_back.y) / 2 };
                const mark_rightW = { x: (p_out_right.x + p_out_right_back.x + p_in_right.x + p_in_right_back.x) / 4, y: (p_out_right.y + p_out_right_back.y + p_in_right.y + p_in_right_back.y) / 4 };
                const p_mid_in = polarToCartesian(cx, cy, R_in, 0);
                const mark_xiaL = { x: (p_mid_front.x + p_mid_in.x) / 2, y: (p_mid_front.y + p_mid_in.y) / 2 };
                const mid_left = { x: (p_out_left.x + p_out_left_back.x) / 2, y: (p_out_left.y + p_out_left_back.y) / 2 };
                const edge_angle = Math.atan2(p_out_left_back.y - p_out_left.y, p_out_left_back.x - p_out_left.x);
                const mark_leftW_pos = { x: mid_left.x + 15 * Math.cos(edge_angle - Math.PI / 2), y: mid_left.y + 15 * Math.sin(edge_angle - Math.PI / 2) };
                const mark_leftW_rot = ((edge_angle - Math.PI / 2) * 180 / Math.PI) + 90;
                const p_back_mid = project(polarToCartesian(cx, cy, R_out, 0));
                const mark_shangL = { x: p_back_mid.x, y: p_back_mid.y - 25 };
                const mark_neiHu = { x: p_mid_in.x, y: p_mid_in.y + 25 };

                const dim_arc_r = R_out + 140;
                const dim_arc_in_r = R_in - 220;
                const p_arc_start = polarToCartesian(cx, cy, dim_arc_r, startAngle);
                const p_arc_end = polarToCartesian(cx, cy, dim_arc_r, endAngle);
                const p_text_arc = polarToCartesian(cx, cy, dim_arc_r + 10, 0);
                const p_arc_in_start = polarToCartesian(cx, cy, dim_arc_in_r, startAngle);
                const p_arc_in_end = polarToCartesian(cx, cy, dim_arc_in_r, endAngle);
                const p_text_arc_in = polarToCartesian(cx, cy, dim_arc_in_r - 10, 0);
                const chord_in_offset = 80;
                const p_chord_in_start = { x: p_in_left.x, y: p_in_left.y + chord_in_offset };
                const p_chord_in_end = { x: p_in_right.x, y: p_in_right.y + chord_in_offset };
                const radius_angle = -theta/2 + 0.05;
                const p_radius_on_arc = polarToCartesian(cx, cy, R_out, radius_angle);
                const p_radius_text_start = polarToCartesian(cx, cy, R_out - 150, radius_angle);
                const radius_in_angle = theta/2 - 0.05;
                const p_radius_in_on_arc = polarToCartesian(cx, cy, R_in, radius_in_angle);
                const p_radius_in_text_start = polarToCartesian(cx, cy, R_in - 150, radius_in_angle);
                const dx_w = W * Math.cos(30 * Math.PI / 180) * 0.5;
                const dy_w = -W * Math.sin(30 * Math.PI / 180) * 0.5;
                const p_r = polarToCartesian(cx, cy, R_out, endAngle);
                const p_r_b = { x: p_r.x + dx_w, y: p_r.y + dy_w };
                const dist_w = 40;
                const p_top = polarToCartesian(cx, cy, R_out, startAngle);
                const p_btm = polarToCartesian(cx, cy, R_in, startAngle);
                const dist_ext = 60;
                const tx = -Math.cos(startAngle) * dist_ext;
                const ty = -Math.sin(startAngle) * dist_ext;
                const p_top_ext = { x: p_top.x + tx, y: p_top.y + ty };
                const p_btm_ext = { x: p_btm.x + tx, y: p_btm.y + ty };
                const mid_T_x = (p_top_ext.x + p_btm_ext.x) / 2;
                const mid_T_y = (p_top_ext.y + p_btm_ext.y) / 2;
                const rot_deg_T = (startAngle * 180 / Math.PI) - 90;
                const offsetH = -180;

                let minX_val = Math.min(p_out_left.x, p_out_left_back.x, p_radius_text_start.x, p_top_ext.x);
                if (showTotalHeight) minX_val = Math.min(minX_val, p_top.x + offsetH - 80);
                const minX = minX_val - 100;
                const maxX = Math.max(p_out_right.x, p_out_right_back.x, p_r_b.x + dist_w) + 100;
                const minY = Math.min(p_out_left.y, p_out_right.y, p_text_arc.y, mark_shangL.y) - 100;
                const maxY = Math.max(p_in_left.y, p_in_right.y, p_chord_in_start.y + 50) + 100;

                return (
                    <svg width="100%" height="100%" viewBox={`${minX} ${minY} ${maxX - minX} ${maxY - minY}`} preserveAspectRatio="xMidYMid meet">
                        <defs>
                            <marker id="arrow-end" markerWidth="6" markerHeight="6" refX="6" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L6,3 L0,6" fill="#444" /></marker>
                            <marker id="dot" markerWidth="8" markerHeight="8" refX="4" refY="4"><circle cx="4" cy="4" r="3" fill="#444" /></marker>
                            <symbol id="tri-vis" viewBox="0 0 20 20"><path d="M0,0 L20,0 L10,17 Z" fill="black" /></symbol>
                        </defs>
                        <path d={pathFace} fill={polish.face ? "#d1d5db" : "#ffffff"} stroke="none" />
                        <path d={pathRightW} fill={polish.rightW ? "#d1d5db" : "#ffffff"} stroke="none" />
                        <path d={pathXiaL} fill={polish.xiaL ? "#d1d5db" : "#ffffff"} stroke="none" />
                        {edges.map((e, i) => <path key={i} d={e.d} fill="none" stroke={e.color} strokeWidth={e.width} strokeLinejoin="round" strokeLinecap="round" />)}
                        {polish.face && <use href="#tri-vis" x={mark_face.x - 10} y={mark_face.y - 10} width="20" height="20" />}
                        {polish.rightW && <use href="#tri-vis" x={mark_rightW.x - 10} y={mark_rightW.y - 10} width="20" height="20" />}
                        {polish.xiaL && <use href="#tri-vis" x={mark_xiaL.x - 10} y={mark_xiaL.y - 10} width="20" height="20" />}
                        {polish.leftW && <use href="#tri-vis" x={mark_leftW_pos.x - 10} y={mark_leftW_pos.y - 10} width="20" height="20" transform={`rotate(${mark_leftW_rot}, ${mark_leftW_pos.x}, ${mark_leftW_pos.y})`} />}
                        {polish.shangL && <use href="#tri-vis" x={mark_shangL.x - 10} y={mark_shangL.y - 10} width="20" height="20" />}
                        {polish.neiHu && <use href="#tri-vis" x={mark_neiHu.x - 10} y={mark_neiHu.y - 10} width="20" height="20" transform={`rotate(180, ${mark_neiHu.x}, ${mark_neiHu.y})`} />}
                        <g fontSize="14" fontFamily="Arial, sans-serif" textAnchor="middle">
                             <line x1={p_out_left.x} y1={p_out_left.y} x2={polarToCartesian(cx, cy, dim_arc_r + 10, startAngle).x} y2={polarToCartesian(cx, cy, dim_arc_r + 10, startAngle).y} stroke="#666" strokeWidth="0.5" />
                             <line x1={p_out_right.x} y1={p_out_right.y} x2={polarToCartesian(cx, cy, dim_arc_r + 10, endAngle).x} y2={polarToCartesian(cx, cy, dim_arc_r + 10, endAngle).y} stroke="#666" strokeWidth="0.5" />
                             <path d={`M ${p_arc_start.x} ${p_arc_start.y} A ${dim_arc_r} ${dim_arc_r} 0 0 1 ${p_arc_end.x} ${p_arc_end.y}`} fill="none" stroke="#444" strokeWidth="1" markerStart="url(#dot)" markerEnd="url(#dot)"/>
                             <text x={p_text_arc.x} y={p_text_arc.y} fill="#333" fontSize="24" paintOrder="stroke" stroke="white" strokeWidth="3">⌒ {L_arc_out.toFixed(0)}</text>
                             <line x1={p_out_left.x} y1={p_out_left.y - 60} x2={p_out_right.x} y2={p_out_right.y - 60} stroke="#666" strokeWidth="1" markerStart="url(#dot)" markerEnd="url(#dot)"/>
                             <text x="0" y={p_out_left.y - 70} fill="#333" fontSize="24" paintOrder="stroke" stroke="white" strokeWidth="3">{chord_out.toFixed(0)}</text>
                             <line x1={p_in_left.x} y1={p_in_left.y} x2={p_in_left.x} y2={p_in_left.y + chord_in_offset} stroke="#666" strokeWidth="0.5" />
                             <line x1={p_in_right.x} y1={p_in_right.y} x2={p_in_right.x} y2={p_in_right.y + chord_in_offset} stroke="#666" strokeWidth="0.5" />
                             <line x1={p_chord_in_start.x} y1={p_chord_in_start.y} x2={p_chord_in_end.x} y2={p_chord_in_end.y} stroke="#666" strokeWidth="1" markerStart="url(#dot)" markerEnd="url(#dot)"/>
                             <text x="0" y={p_chord_in_start.y + 25} fill="#333" fontSize="24" paintOrder="stroke" stroke="white" strokeWidth="3">{chord_in.toFixed(0)}</text>
                             <line x1={p_in_left.x} y1={p_in_left.y} x2={polarToCartesian(cx, cy, dim_arc_in_r - 10, startAngle).x} y2={polarToCartesian(cx, cy, dim_arc_in_r - 10, startAngle).y} stroke="#666" strokeWidth="0.5" />
                             <line x1={p_in_right.x} y1={p_in_right.y} x2={polarToCartesian(cx, cy, dim_arc_in_r - 10, endAngle).x} y2={polarToCartesian(cx, cy, dim_arc_in_r - 10, endAngle).y} stroke="#666" strokeWidth="0.5" />
                             <path d={`M ${p_arc_in_start.x} ${p_arc_in_start.y} A ${dim_arc_in_r} ${dim_arc_in_r} 0 0 1 ${p_arc_in_end.x} ${p_arc_in_end.y}`} fill="none" stroke="#444" strokeWidth="1" markerStart="url(#dot)" markerEnd="url(#dot)"/>
                             <text x={p_text_arc_in.x} y={p_text_arc_in.y + 10} fill="#333" fontSize="24" paintOrder="stroke" stroke="white" strokeWidth="3">⌒ {L_arc_in.toFixed(0)}</text>
                             <line x1={p_radius_text_start.x} y1={p_radius_text_start.y} x2={p_radius_on_arc.x} y2={p_radius_on_arc.y} stroke="#444" strokeWidth="1" markerEnd="url(#arrow-end)"/>
                             <text x={p_radius_text_start.x - 10} y={p_radius_text_start.y} fill="#333" fontSize="24" transform={`rotate(${(radius_angle * 180 / Math.PI) - 90}, ${p_radius_text_start.x}, ${p_radius_text_start.y})`} textAnchor="end" paintOrder="stroke" stroke="white" strokeWidth="3">R{R_out.toFixed(0)}</text>
                             <line x1={p_radius_in_text_start.x} y1={p_radius_in_text_start.y} x2={p_radius_in_on_arc.x} y2={p_radius_in_on_arc.y} stroke="#444" strokeWidth="1" markerEnd="url(#arrow-end)"/>
                             <text x={p_radius_in_text_start.x + 10} y={p_radius_in_text_start.y} fill="#333" fontSize="24" transform={`rotate(${(radius_in_angle * 180 / Math.PI) - 90}, ${p_radius_in_text_start.x}, ${p_radius_in_text_start.y})`} textAnchor="start" paintOrder="stroke" stroke="white" strokeWidth="3">R{R_in.toFixed(0)}</text>
                             <line x1={p_r.x} y1={p_r.y} x2={p_r.x + dist_w} y2={p_r.y - dist_w} stroke="#666" strokeWidth="0.5" />
                             <line x1={p_r_b.x} y1={p_r_b.y} x2={p_r_b.x + dist_w} y2={p_r_b.y - dist_w} stroke="#666" strokeWidth="0.5" />
                             <line x1={p_r.x + dist_w} y1={p_r.y - dist_w} x2={p_r_b.x + dist_w} y2={p_r_b.y - dist_w} stroke="#444" strokeWidth="1" markerStart="url(#dot)" markerEnd="url(#dot)"/>
                             <text x={(p_r.x + p_r_b.x)/2 + dist_w + 10} y={(p_r.y + p_r_b.y)/2 - dist_w - 10} fill="#333" fontSize="24" transform={`rotate(-30, ${(p_r.x + p_r_b.x)/2 + dist_w}, ${(p_r.y + p_r_b.y)/2 - dist_w})`} paintOrder="stroke" stroke="white" strokeWidth="3">W = {W}</text>
                             <line x1={p_top.x} y1={p_top.y} x2={p_top_ext.x} y2={p_top_ext.y} stroke="#666" strokeWidth="0.5" />
                             <line x1={p_btm.x} y1={p_btm.y} x2={p_btm_ext.x} y2={p_btm_ext.y} stroke="#666" strokeWidth="0.5" />
                             <line x1={p_top_ext.x} y1={p_top_ext.y} x2={p_btm_ext.x} y2={p_btm_ext.y} stroke="#444" strokeWidth="1" markerStart="url(#dot)" markerEnd="url(#dot)"/>
                             <text x={mid_T_x} y={mid_T_y} dy="-8" fill="#333" fontSize="24" textAnchor="middle" transform={`rotate(${rot_deg_T}, ${mid_T_x}, ${mid_T_y})`} paintOrder="stroke" stroke="white" strokeWidth="3">{T}</text>
                             {showTotalHeight && (
                                <>
                                     <line x1="0" y1="0" x2={p_top.x + offsetH} y2="0" stroke="#666" strokeWidth="0.5" strokeDasharray="4" />
                                     <line x1={p_btm.x} y1={p_btm.y} x2={p_top.x + offsetH} y2={p_btm.y} stroke="#666" strokeWidth="0.5" strokeDasharray="4" />
                                     <line x1={p_top.x + offsetH + 10} y1="0" x2={p_top.x + offsetH + 10} y2={p_btm.y} stroke="#444" strokeWidth="1" markerStart="url(#dot)" markerEnd="url(#dot)"/>
                                     <text x={p_top.x + offsetH - 10} y={p_btm.y/2 + 5} fill="#333" fontSize="24" textAnchor="end" paintOrder="stroke" stroke="white" strokeWidth="3">H={total_h.toFixed(0)}</text>
                                </>
                             )}
                        </g>
                    </svg>
                );
            }, [result, dims, polish, showTotalHeight]);

            if (!result.valid) return <div className="flex flex-col items-center justify-center h-full text-gray-400"><AlertCircle size={40} className="mb-2 opacity-20" /><p>请输入至少2个几何参数以生成图纸</p></div>;
            return <div className="w-full h-full flex items-center justify-center p-8">{svgContent}</div>;
        };

        const TRIANGLE_MAPPING = [
            { key: 'rightW', id: 'tri-top', label: '右侧 (Right W)' },
            { key: 'shangL', id: 'tri-top-left', label: '上L (Top L)' },
            { key: 'leftW', id: 'tri-mid', label: '左侧 (Left W)' },
            { key: 'face', id: 'tri-mid-left', label: '外弧面 (Face)' },
            { key: 'neiHu', id: 'tri-mid-right', label: '内弧面 (Inner)' },
            { key: 'xiaL', id: 'tri-bottom', label: '下L (Bottom L)' },
        ];

        const BlueprintView = ({ result, dims, polish, showTotalHeight }) => {
            const [textOverrides, setTextOverrides] = useState({});
            const [visibleTriangles, setVisibleTriangles] = useState({});

            useEffect(() => {
                if (!result.valid) return;
                const defaults = {
                    'txt-w2000': `W=${dims.width}`, 'txt-arc-983': `⌒${result.L_arc_out.toFixed(0)}`,
                    'txt-981': `${result.chord_out.toFixed(0)}`, 'txt-976': `${result.chord_out.toFixed(0)}`,
                    'txt-h54': `H${result.total_h.toFixed(0)}`, 'txt-arc-977': `⌒${result.L_arc_in.toFixed(0)}`,
                    'txt-r5020': `R${result.R_out.toFixed(0)}`, 'txt-r4990': `R${result.R_in.toFixed(0)}`,
                    'txt-30t': `${dims.thickness}T`
                };
                setTextOverrides(defaults);
                const vis = {};
                TRIANGLE_MAPPING.forEach(m => { vis[m.id] = polish[m.key]; });
                setVisibleTriangles(vis);
            }, [result, dims, polish]);

            const handleTextChange = (id, value) => setTextOverrides(prev => ({ ...prev, [id]: value }));
            const toggleTriangle = (id) => setVisibleTriangles(prev => ({ ...prev, [id]: !prev[id] }));

            if (!result.valid) return <div className="flex items-center justify-center h-full text-gray-400"><p>无效的计算数据，请返回计算器。</p></div>;

            const textElements = [
                { id: 'txt-w2000', label: '宽度 (W)' }, { id: 'txt-arc-983', label: '外弧长' },
                { id: 'txt-981', label: '外弦长' }, { id: 'txt-976', label: '右侧弦长' },
                { id: 'txt-h54', label: '总高 (H)' }, { id: 'txt-arc-977', label: '内弧长' },
                { id: 'txt-r5020', label: '外半径 (R)' }, { id: 'txt-r4990', label: '内半径 (r)' },
                { id: 'txt-30t', label: '厚度' }
            ];

            return (
                <div className="flex flex-row h-full overflow-hidden bg-gray-50">
                    <div className="flex-1 flex items-center justify-center p-8 bg-white m-4 rounded-lg shadow-sm border border-gray-200 relative overflow-hidden bg-grid-pattern">
                        <svg viewBox="0 0 95.77 214.27" className="max-w-full max-h-full drop-shadow-2xl bg-white rounded">
                            <defs><style>{`.cls-1,.cls-2,.cls-3,.cls-4,.cls-8{fill:none;}.cls-1,.cls-3,.cls-4{stroke:#231815;stroke-width:0.28px;}.cls-1{stroke-linecap:round;}.cls-1,.cls-3{stroke-linejoin:round;}.cls-2,.cls-8{stroke:#e83818;}.cls-2,.cls-4,.cls-8{stroke-miterlimit:10;}.cls-2{stroke-width:0.11px;}.cls-5{font-size:4.38px;}.cls-10,.cls-11,.cls-12,.cls-5,.cls-6,.cls-7{fill:#e60012;}.cls-10,.cls-11,.cls-5,.cls-6,.cls-7{font-family:MicrosoftYaHei, Microsoft YaHei;}.cls-6{font-size:3.29px;}.cls-7{font-size:3.39px;}.cls-8{stroke-width:0.23px;}.cls-9{fill:#e83818;}.cls-10{font-size:3.39px;}.cls-11{font-size:4.89px;}.cls-13{fill:#231815; cursor: pointer;} text { cursor: pointer; } text:hover { font-weight: bold; }`}</style></defs>
                            <path d="M61.34,13.45l6.65,4S29.9,61.71,61.34,107l-7.66,3.83S19.67,72.62,61.34,13.45Z" className="cls-1"></path>
                            <path d="M47.05,111s-34-38.68,7.68-97.85" className="cls-2"></path>
                            <polyline points="61.34 106.98 61.34 200.92 53.68 207.11 53.68 110.81" className="cls-3"></polyline>
                            <path d="M40.61,69.94V190s1.29,8.44,13.07,17.13" className="cls-4"></path>

                            <text id="txt-w2000" transform="translate(71.35 153.69)" className="cls-5">{textOverrides['txt-w2000']}</text>
                            <text id="txt-arc-983" transform="translate(25.96 64.46)" className="cls-5">{textOverrides['txt-arc-983']}</text>
                            <text id="txt-981" transform="translate(15.04 64.46)" className="cls-5">{textOverrides['txt-981']}</text>
                            <text id="txt-976" transform="translate(74.79 64.46)" className="cls-5">{textOverrides['txt-976']}</text>
                            {showTotalHeight && <text id="txt-h54" transform="translate(49.83 71.47)" className="cls-6">{textOverrides['txt-h54']}</text>}
                            <text id="txt-arc-977" transform="translate(52.53 64.24)" className="cls-5">{textOverrides['txt-arc-977']}</text>
                            <text id="txt-r5020" transform="matrix(0.93, -0.37, 0.37, 0.93, 48.7, 97.45)" className="cls-7">{textOverrides['txt-r5020']}</text>
                            <text id="txt-r4990" transform="matrix(0.95, 0.3, -0.3, 0.95, 65.04, 27.89)" className="cls-10">{textOverrides['txt-r4990']}</text>
                            <text id="txt-30t" transform="translate(64.75 9.47) rotate(34.19)" className="cls-11">{textOverrides['txt-30t']}</text>

                            <line y2="93.66" x2="59.75" y1="98.68" x1="47.95" className="cls-8"></line>
                            <path d="M46.69,99.22a6.76,6.76,0,0,1,2.21.23l-.78-.84-.06-1.14A7.1,7.1,0,0,1,46.69,99.22Z" className="cls-9"></path>
                            <line y2="31.61" x2="74.52" y1="27.99" x1="63.15" className="cls-8"></line>
                            <path d="M61.85,27.57a7,7,0,0,1,1.52,1.62l0-1.15.7-.91A6.55,6.55,0,0,1,61.85,27.57Z" className="cls-9"></path>
                            <line y2="10.81" x2="63.45" y1="12.45" x1="62.12" className="cls-2"></line>
                            <line y2="14.95" x2="69.84" y1="10.84" x1="63.43" className="cls-2"></line>
                            <line y2="200.63" x2="70.25" y1="107" x1="70.17" className="cls-2"></line>
                            <line y2="110.96" x2="22.9" y1="13.28" x1="22.83" className="cls-2"></line>
                            <line y2="106.95" x2="82.86" y1="18.31" x1="82.79" className="cls-2"></line>
                            <circle r="0.43" cy="10.84" cx="63.43" className="cls-12"></circle>
                            <circle r="0.43" cy="13.18" cx="54.74" className="cls-9"></circle>
                            <circle r="0.43" cy="110.95" cx="47.05" className="cls-9"></circle>
                            <circle r="0.43" cy="110.95" cx="22.89" className="cls-9"></circle>
                            <line y2="14.92" x2="69.86" y1="16.66" x1="68.42" className="cls-2"></line>
                            <circle r="0.43" cy="14.95" cx="69.84" className="cls-12"></circle>
                            <line y2="13.12" x2="54.73" y1="13.12" x1="59.83" className="cls-2"></line>
                            <line y2="18.27" x2="72.91" y1="18.27" x1="78.01" className="cls-2"></line>
                            <line y2="106.95" x2="65.13" y1="106.95" x1="70.23" className="cls-2"></line>
                            <circle r="0.43" cy="13.18" cx="22.82" className="cls-9"></circle>
                            <line y2="13.12" x2="22.81" y1="13.12" x1="29.91" className="cls-2"></line>
                            {showTotalHeight && <><circle r="0.43" cy="68.06" cx="40.65" className="cls-9"></circle><circle r="0.43" cy="68.06" cx="60.79" className="cls-9"></circle><line y2="68" x2="40.41" y1="68" x1="60.8" className="cls-2"></line></>}
                            <line y2="110.96" x2="22.81" y1="110.96" x1="29.91" className="cls-2"></line>
                            <line y2="111.02" x2="47.05" y1="110.88" x1="52.21" className="cls-2"></line>
                            <path d="M70.16,107C61.93,96.54,44.67,65.63,78,18.27" className="cls-2"></path>
                            <circle r="0.43" cy="18.31" cx="77.95" className="cls-9"></circle>
                            <circle r="0.43" cy="106.99" cx="70.15" className="cls-9"></circle>
                            <line y2="200.59" x2="65.23" y1="200.59" x1="70.33" className="cls-2"></line>
                            <circle r="0.43" cy="200.64" cx="70.25" className="cls-9"></circle>
                            <line y2="18.27" x2="79.81" y1="18.27" x1="82.91" className="cls-2"></line>
                            <line y2="106.95" x2="76.39" y1="106.95" x1="82.92" className="cls-2"></line>
                            <circle r="0.43" cy="18.31" cx="82.85" className="cls-9"></circle>
                            <circle r="0.43" cy="106.99" cx="82.84" className="cls-9"></circle>

                            <polygon id="tri-mid" points="57.51 152.92 58.67 150.38 56.35 150.38 57.51 152.92" className="cls-13" style={{ display: visibleTriangles['tri-mid'] ? 'block' : 'none' }} onClick={() => toggleTriangle('tri-mid')} />
                            <polygon id="tri-bottom" points="58.26 205.45 57.1 207.99 59.42 207.99 58.26 205.45" className="cls-13" style={{ display: visibleTriangles['tri-bottom'] ? 'block' : 'none' }} onClick={() => toggleTriangle('tri-bottom')} />
                            <polygon id="tri-mid-left" points="47.07 152.52 48.23 149.98 45.91 149.98 47.07 152.52" className="cls-13" style={{ display: visibleTriangles['tri-mid-left'] ? 'block' : 'none' }} onClick={() => toggleTriangle('tri-mid-left')} />
                            <polygon id="tri-top-left" points="44.83 67.2 45.99 64.66 43.67 64.66 44.83 67.2" className="cls-13" style={{ display: visibleTriangles['tri-top-left'] ? 'block' : 'none' }} onClick={() => toggleTriangle('tri-top-left')} />
                            <polygon id="tri-mid-right" points="63.03 151.42 65.58 152.59 65.58 150.26 63.03 151.42" className="cls-13" style={{ display: visibleTriangles['tri-mid-right'] ? 'block' : 'none' }} onClick={() => toggleTriangle('tri-mid-right')} />
                            <polygon id="tri-top" points="64.76 15.09 66.89 13.77 65.16 12.61 64.76 15.09" className="cls-13" style={{ display: visibleTriangles['tri-top'] ? 'block' : 'none' }} onClick={() => toggleTriangle('tri-top')} />
                        </svg>
                    </div>

                    {/* 右侧面板：工程图编辑器 (仅在蓝图模式显示) */}
                    <div className="w-80 bg-white border-l p-4 flex flex-col gap-4 overflow-y-auto z-10 shadow-lg">
                        <div className="pb-2 border-b"><h3 className="font-bold text-gray-700">工程图编辑器</h3><p className="text-xs text-gray-500">在此处修改数值会覆盖自动计算结果。</p></div>
                        <div>
                            <h4 className="text-xs font-bold text-gray-400 uppercase mb-2">标注文字</h4>
                            <div className="space-y-2">
                                {textElements.map(el => {
                                    if (el.id === 'txt-h54' && !showTotalHeight) return null;
                                    return (
                                        <div key={el.id} className="flex flex-col bg-gray-50 p-2 rounded border border-transparent focus-within:border-blue-300 focus-within:bg-blue-50 transition-colors">
                                            <label className="text-[10px] text-gray-500 font-semibold">{el.label}</label>
                                            <input type="text" value={textOverrides[el.id] || ''} onChange={(e) => handleTextChange(el.id, e.target.value)} className="bg-transparent outline-none text-sm text-gray-800" />
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                        <div>
                            <h4 className="text-xs font-bold text-gray-400 uppercase mb-2">红色标记 (三角形)</h4>
                            <div className="space-y-2">
                                {TRIANGLE_MAPPING.map(item => (
                                    <div key={item.id} className="flex items-center justify-between p-2 rounded bg-gray-50 border hover:bg-gray-100 cursor-pointer" onClick={() => toggleTriangle(item.id)}>
                                        <span className="text-sm text-gray-700">{item.label}</span>
                                        <div className={`w-9 h-5 rounded-full relative transition-colors ${visibleTriangles[item.id] ? 'bg-red-500' : 'bg-gray-300'}`}>
                                            <div className={`absolute top-1 left-1 bg-white w-3 h-3 rounded-full transition-transform ${visibleTriangles[item.id] ? 'translate-x-4' : 'translate-x-0'}`} />
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const InputGroup = ({ label, id, value, onChange, color = 'blue', active }) => (
            <div className="relative group">
                <input type="number" id={id} value={value} onChange={(e) => onChange(e.target.value)} className={`w-full p-2 pt-5 text-sm border rounded outline-none transition-colors ${color === 'orange' ? 'bg-orange-50/30 focus:ring-orange-100' : 'focus:ring-blue-100'} ${active ? (color === 'orange' ? 'border-orange-300' : 'border-blue-300') : 'border-gray-300'}`} />
                <span className="absolute left-2 top-1 text-[10px] text-gray-400 font-bold pointer-events-none group-focus-within:text-gray-600">{label}</span>
            </div>
        );

        const PolishBtn = ({ label, active, onClick }) => (
            <button onClick={onClick} className={`flex items-center justify-center p-2 border rounded text-xs font-medium transition-all ${active ? 'bg-slate-800 text-white border-slate-800 shadow-sm' : 'bg-white hover:bg-gray-50 text-gray-700 border-gray-200'}`}>{label}</button>
        );

        const ResultRow = ({ label, value, bold }) => (
            <div className="flex justify-between"><span className="text-blue-400">{label}:</span><span className={`font-mono ${bold ? 'font-bold text-slate-800' : 'text-slate-600'}`}>{value.toFixed(1)}</span></div>
        );

        const App = () => {
            const [viewMode, setViewMode] = useState('CALCULATOR');
            const [inputs, setInputs] = useState({ radiusOut: '5020', arcOut: '983', chordOut: '', totalHeight: '', radiusIn: '', arcIn: '' });
            const [dims, setDims] = useState({ width: 2000, thickness: 30 });
            const [polish, setPolish] = useState({ face: true, neiHu: false, shangL: false, xiaL: false, leftW: false, rightW: false });
            const [showTotalHeight, setShowTotalHeight] = useState(false);
            const [result, setResult] = useState(null);

            const handleInputChange = (field, value) => setInputs(prev => ({ ...prev, [field]: value }));
            const handleDimChange = (field, value) => setDims(prev => ({ ...prev, [field]: parseFloat(value) || 0 }));
            const togglePolish = (field) => setPolish(prev => ({ ...prev, [field]: !prev[field] }));
            const resetParams = () => setInputs({ radiusOut: '', arcOut: '', chordOut: '', totalHeight: '', radiusIn: '', arcIn: '' });

            useEffect(() => { setResult(calculateGeometry(inputs, dims)); }, [inputs, dims]);

            return (
                <div className="flex flex-row h-screen w-screen overflow-hidden bg-gray-50">
                    {/* 左侧侧边栏 (固定宽度，始终显示) */}
                    <div className="w-[360px] bg-white border-r flex flex-col h-full shadow-xl z-20 flex-shrink-0">
                         <div className="p-4 border-b flex items-center justify-between bg-white">
                            <div className="flex items-center gap-2">
                                <div className="bg-blue-600 text-white p-1.5 rounded-md"><Ruler size={18} /></div>
                                <h1 className="font-bold text-lg text-gray-800">弧形板计算大师</h1>
                            </div>
                         </div>
                         
                         <div className="flex-1 overflow-y-auto p-5 space-y-6">
                            {/* 视图切换 */}
                            <div className="flex bg-gray-100 p-1 rounded-lg mb-4">
                                <button onClick={() => setViewMode('CALCULATOR')} className={`flex-1 flex items-center justify-center gap-2 py-1.5 rounded text-sm font-medium transition-all ${viewMode === 'CALCULATOR' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}><Ruler size={14} /> 计算预览</button>
                                <button onClick={() => setViewMode('BLUEPRINT')} className={`flex-1 flex items-center justify-center gap-2 py-1.5 rounded text-sm font-medium transition-all ${viewMode === 'BLUEPRINT' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}><FileText size={14} /> 工程蓝图</button>
                            </div>

                            {/* 参数设置区 (始终显示) */}
                            <div>
                                <div className="flex items-center justify-between pb-2 border-b mb-4"><h2 className="font-bold text-gray-700">参数设置</h2><button onClick={resetParams} className="text-xs text-blue-600 flex items-center gap-1 hover:bg-blue-50 px-2 py-1 rounded transition-colors"><RotateCcw size={12} /> 重置</button></div>
                                <div className="space-y-4">
                                    <div>
                                        <label className="text-xs font-bold text-gray-400 uppercase mb-2 block">几何参数 (任选2项)</label>
                                        <div className="grid grid-cols-2 gap-3">
                                            <InputGroup label="外半径 (R)" id="radiusOut" value={inputs.radiusOut} onChange={(v) => handleInputChange('radiusOut', v)} active={!!result?.valid && !!inputs.radiusOut} />
                                            <InputGroup label="外弧长 (L)" id="arcOut" value={inputs.arcOut} onChange={(v) => handleInputChange('arcOut', v)} active={!!result?.valid && !!inputs.arcOut} />
                                            <InputGroup label="外弦长 (C)" id="chordOut" value={inputs.chordOut} onChange={(v) => handleInputChange('chordOut', v)} active={!!result?.valid && !!inputs.chordOut} />
                                            <InputGroup label="总拱高 (H)" id="totalHeight" value={inputs.totalHeight} onChange={(v) => handleInputChange('totalHeight', v)} active={!!result?.valid && !!inputs.totalHeight} />
                                            <InputGroup label="内半径 (r)" id="radiusIn" value={inputs.radiusIn} onChange={(v) => handleInputChange('radiusIn', v)} color="orange" active={!!result?.valid && !!inputs.radiusIn} />
                                            <InputGroup label="内弧长 (l)" id="arcIn" value={inputs.arcIn} onChange={(v) => handleInputChange('arcIn', v)} color="orange" active={!!result?.valid && !!inputs.arcIn} />
                                        </div>
                                        <div className={`mt-3 text-xs flex items-center gap-1 font-medium ${result?.valid ? 'text-green-600' : (result?.errorMsg ? 'text-red-500' : 'text-orange-500')}`}>
                                            {result?.valid ? <><CheckCircle2 size={12} /> 计算方式: {result.method}</> : <><AlertCircle size={12} /> {result?.errorMsg || "请输入至少2个参数"}</>}
                                        </div>
                                    </div>
                                     <div>
                                        <label className="text-xs font-bold text-gray-400 uppercase mb-2 block">板材尺寸</label>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div className="relative"><input type="number" value={dims.width} onChange={(e) => handleDimChange('width', e.target.value)} className="w-full p-2 text-sm border border-gray-300 rounded outline-none focus:border-blue-500" /><span className="absolute right-2 top-2 text-xs text-gray-400 pointer-events-none">W (宽)</span></div>
                                            <div className="relative"><input type="number" value={dims.thickness} onChange={(e) => handleDimChange('thickness', e.target.value)} className="w-full p-2 text-sm border border-gray-300 rounded outline-none focus:border-blue-500" /><span className="absolute right-2 top-2 text-xs text-gray-400 pointer-events-none">T (厚)</span></div>
                                        </div>
                                    </div>
                                     <div className="bg-gray-50 p-2 rounded border border-gray-100">
                                         <button onClick={() => setShowTotalHeight(!showTotalHeight)} className={`w-full flex items-center justify-between px-3 py-2 rounded text-xs font-medium border transition-colors ${showTotalHeight ? 'bg-blue-100 border-blue-200 text-blue-700' : 'bg-white border-gray-200 text-gray-600 hover:bg-gray-50'}`}>
                                            <span className="flex items-center gap-2">{showTotalHeight ? <Eye size={14} /> : <EyeOff size={14} />} 显示总高 (H)</span>
                                            <span className={`w-8 h-4 rounded-full relative transition-colors ${showTotalHeight ? 'bg-blue-500' : 'bg-gray-300'}`}><span className={`absolute top-0.5 left-0.5 w-3 h-3 bg-white rounded-full transition-transform ${showTotalHeight ? 'translate-x-4' : 'translate-x-0'}`} /></span>
                                        </button>
                                     </div>
                                    <div className="pt-2 border-t">
                                         <label className="text-xs font-bold text-gray-400 uppercase mb-3 block">抛光/标识 (红色)</label>
                                         <div className="grid grid-cols-3 gap-2">
                                            <PolishBtn label="外弧面" active={polish.face} onClick={() => togglePolish('face')} />
                                            <PolishBtn label="内弧面" active={polish.neiHu} onClick={() => togglePolish('neiHu')} />
                                            <PolishBtn label="上L (L)" active={polish.shangL} onClick={() => togglePolish('shangL')} />
                                            <PolishBtn label="下L (L)" active={polish.xiaL} onClick={() => togglePolish('xiaL')} />
                                            <PolishBtn label="左侧 (W)" active={polish.leftW} onClick={() => togglePolish('leftW')} />
                                            <PolishBtn label="右侧 (W)" active={polish.rightW} onClick={() => togglePolish('rightW')} />
                                         </div>
                                    </div>
                                     {result?.valid && (
                                         <div className="bg-blue-50 rounded-lg p-3 border border-blue-100 text-xs mt-auto">
                                            <h3 className="font-bold text-blue-800 mb-2">计算结果</h3>
                                            <div className="grid grid-cols-2 gap-y-1 gap-x-2">
                                                <ResultRow label="外半径 R" value={result.R_out} />
                                                <ResultRow label="内半径 r" value={result.R_in} bold />
                                                <ResultRow label="外弧长 L" value={result.L_arc_out} />
                                                <ResultRow label="内弧长 l" value={result.L_arc_in} bold />
                                                <ResultRow label="弦长 C" value={result.chord_out} />
                                                <ResultRow label="总高 H" value={result.total_h} bold />
                                            </div>
                                         </div>
                                     )}
                                </div>
                            </div>
                         </div>
                    </div>

                    {/* 右侧主绘图区 (自适应剩余空间) */}
                    <div className="flex-1 bg-gray-50 relative overflow-hidden flex flex-col h-full bg-grid-pattern">
                        {viewMode === 'CALCULATOR' ? (
                            <div className="w-full h-full flex items-center justify-center p-8">
                                <div className="w-full h-full bg-white rounded-lg border shadow-sm overflow-hidden relative">
                                    {result && <Calculator3DPreview result={result} dims={dims} polish={polish} showTotalHeight={showTotalHeight} />}
                                </div>
                            </div>
                        ) : (
                            <div className="w-full h-full overflow-hidden">
                                {result && <BlueprintView result={result} dims={dims} polish={polish} showTotalHeight={showTotalHeight} />}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
